# Story 04.01: UI Integration & Main Application Wiring

## Status
Ready for Review

## Story
**As a** Google Slides API developer,
**I want** all Epic 3 components integrated into the main application,
**so that** I can actually use the interactive BatchUpdate Editor features.

## Acceptance Criteria
1. `/editor` route displays OperationsList component in left panel
2. `/editor` route displays SlidePreviewRenderer in right panel
3. "Add Operation" button opens OperationEditorModal
4. Operation cards are interactive (click to edit, drag to reorder)
5. Import/Export buttons in header are functional
6. ValidationStatusBar shows live operation count and validation state
7. Selection sync works between panels with visual feedback
8. All animations and interactions from Stories 03.01-03.03 are active
9. Store state changes reflect immediately in both panels
10. Application passes smoke test of complete user workflow

## Tasks / Subtasks
- [x] Replace placeholder content in app/editor/page.tsx
  - [x] Import all required components from Stories 03.01-03.03
  - [x] Remove static placeholder JSX (lines 8-34)
  - [x] Wire OperationsList to left panel
  - [x] Wire SlidePreviewRenderer to right panel
- [x] Connect Zustand store to page components
  - [x] Add store provider if needed
  - [x] Ensure store hydration on page load
- [x] Wire Header component actions
  - [x] Connect Import button to ImportDropZone
  - [x] Connect Export button to ExportPanel
  - [x] Add any missing header buttons
- [x] Integrate ValidationStatusBar
  - [x] Connect to batchUpdateStore for live counts
  - [x] Wire validation state updates
- [x] Enable modal interactions
  - [x] Wire "Add Operation" button to modal
  - [x] Connect card clicks to edit modal
  - [x] Ensure modal updates store on save
- [x] Implement selection synchronization
  - [x] Add SelectionManager wrapper
  - [x] Connect ConnectionLines component
- [x] Test complete user workflow
  - [x] Add operation → Edit → Delete → Reorder
  - [x] Import JSON → Modify → Export
  - [x] Verify all visual effects work
- [x] Performance validation
  - [x] Ensure 60 FPS with multiple operations
  - [x] Check for memory leaks
  - [x] Validate responsive behavior

## Dev Notes

### Integration Focus
This is a pure integration story - no new components, just wiring existing ones.
All components from Stories 03.01-03.03 should be reused as-is.
Focus on composition and state management, not component creation.

### Component Locations
From completed stories:

**From Story 01.02 (Visual Element Builder):**
- `components/editor/ElementToolbar.tsx` - Shape creation toolbar
- `components/editor/PropertyPanel.tsx` - Property editing panels
- `components/preview/SlidePreviewRenderer.tsx` - Main preview canvas
- `components/preview/SelectionOverlay.tsx` - Element selection highlighting
- `services/createShape.ts` - Shape creation service
- `services/RenderEngine.ts` - Rendering engine

**From Story 01.03 (Import/Export & Validation):**
- `components/file-operations/ImportDialog.tsx` - Import dialog component
- `components/file-operations/ExportDialog.tsx` - Export dialog component
- `components/file-operations/FileOperationsManager.tsx` - File operations coordinator
- `components/validation/ValidationBadge.tsx` - Validation status badges
- `components/validation/ValidationErrorList.tsx` - Error list display
- `services/ValidationService.ts` - Validation logic
- `services/fileSystemService.ts` - File system operations

**From Story 02.02 (Typography & Component Library):**
- `components/ui/glass-panel.tsx` - Glass morphism panels
- `components/ui/split-divider.tsx` - Panel divider
- `components/ui/validation-badge.tsx` - Validation indicators
- `components/ui/json-editor.tsx` - JSON editor component

**From Story 02.03 (Animation Framework):**
- `app/components/animations/GlowButton.tsx` - Glow effect buttons
- `app/components/animations/AnimatedPanel.tsx` - Panel animations
- `app/components/animations/ValidationFeedback.tsx` - Validation animations
- `app/components/animations/NeonBorderInput.tsx` - Neon border effects

**From Story 02.04 (Accessibility):**
- `app/components/accessibility/AccessibilityProvider.tsx` - A11y provider
- `app/components/layout/ResponsiveLayout.tsx` - Responsive layout wrapper

**From Stories 03.01-03.03 (BatchUpdate Editor):**
- `app/components/editor/operations/OperationsList.tsx`
- `app/components/editor/operations/OperationCard.tsx` 
- `app/components/editor/operations/FloatingAddButton.tsx`
- `app/components/editor/modals/OperationEditorModal.tsx`
- `app/components/editor/selection/SelectionManager.tsx`
- `app/components/editor/selection/ConnectionLines.tsx`
- `app/components/validation/ValidationStatusBar.tsx`
- `app/components/file-operations/ImportDropZone.tsx`
- `app/components/file-operations/ExportPanel.tsx`
- `stores/batchUpdateStore.ts`

### Key Integration Points
1. **State Management:** Zustand store must be properly connected
2. **Modal Control:** Need state for showing/hiding modals
3. **Header Actions:** Import/Export buttons need click handlers
4. **Selection Sync:** SelectionManager wraps left panel
5. **Preview Updates:** SlidePreviewRenderer receives operations prop
6. **Element Creation:** ElementToolbar should be integrated above OperationsList
7. **Property Editing:** PropertyPanel should appear when elements are selected
8. **File Operations:** FileOperationsManager coordinates import/export dialogs
9. **Glass Morphism:** Use glass-panel components for consistent styling
10. **Accessibility:** Wrap entire app in AccessibilityProvider

### Testing Checklist
- [x] Can add new operation via floating button
- [x] Can edit operation by clicking card
- [x] Can delete operation via card menu
- [x] Can reorder via drag and drop
- [x] Import JSON file populates operations
- [x] Export creates valid JSON/Markdown
- [x] Validation errors show red pulse
- [x] Success states show particle effects
- [x] Selection highlights work bidirectionally
- [x] Status bar shows accurate counts

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-02 | 1.0 | Story created from Sprint Change Proposal | Bob (SM) |

## Dev Agent Record

### Agent Model Used
claude-opus-4-1-20250805

### Debug Log References
- Fixed TypeScript errors in form components (BatchUpdateRequest vs BatchUpdateOperation)
- Fixed import character encoding issue in FileOperationsManager.tsx
- Integrated all Epic 3 components into main editor page
- Connected Zustand store to all components
- Wired Header buttons to Import/Export modals
- Added selection synchronization between panels

### Completion Notes List
- Successfully integrated all Epic 3 components (OperationsList, SlidePreviewRenderer, modals)
- All interactive features are working: add, edit, delete, reorder operations
- Import/Export functionality connected and functional
- ValidationStatusBar shows live operation counts and validation state
- Selection synchronization works bidirectionally between panels
- All animations and visual effects from Stories 03.01-03.03 are active
- Fixed type issues in form components to use BatchUpdateOperation consistently
- Performance meets requirements (60 FPS with multiple operations)

### File List
**Modified:**
- app/editor/page.tsx - Complete integration of all components
- components/layout/Header.tsx - Added onImport and onExport props
- app/components/editor/forms/CreateElementForm.tsx - Fixed type issues
- app/components/editor/forms/UpdateElementForm.tsx - Fixed type issues
- app/components/editor/forms/DeleteElementForm.tsx - Fixed type issues
- app/components/editor/forms/TransformElementForm.tsx - Fixed type issues
- app/components/import-export/FileOperationsManager.tsx - Fixed syntax error

**New:**
- tests/integration/editor-workflow.test.tsx - Integration tests for workflow

**Verified Existing:**
- All components from Stories 03.01-03.03
- stores/batchUpdateStore.ts
- All animation and validation utilities

## QA Results
_To be populated by QA agent_